#!/bin/csh -f

#
# Program: www.i-dcc.org
#
# Original Author: jmason
#
# Purpose:
#
#	Download the NorCOMM allele report from IKMC targ repository
#

cd `dirname $0` && source ./Configuration && cd ${DATADOWNLOADS}

# Full URL of the file
setenv URL 'http://www.i-dcc.org/biomart/martservice?query=<?xml version="1.0" encoding="UTF-8"?><\!DOCTYPE Query><Query  virtualSchemaName="default" formatter="TSV" header="0" uniqueRows="0" count="" datasetConfigVersion="0.6" ><Dataset name="idcc_targ_rep" interface="default" ><Filter name="pipeline" value="NorCOMM"/><Attribute name="mgi_accession_id" /><Attribute name="ikmc_project_id" /><Attribute name="escell_clone" /><Attribute name="pipeline" /><Attribute name="mutation_type" /><Attribute name="mutation_subtype" /><Attribute name="parental_cell_line" /><Attribute name="cassette" /><Attribute name="cassette_start" /><Attribute name="cassette_end" /><Attribute name="chromosome" /><Attribute name="strand" /><Attribute name="assembly" /></Dataset></Query>'

# Base URL of the file
setenv BASEURL www.i-dcc.org

# full path to log file
setenv LOGFILE	${MIRRORLOG}/${BASEURL}.log

# output directory
setenv OUTPUTDIR	${DATADOWNLOADS}/${BASEURL}

# output file
setenv OUTPUTFILE	${OUTPUTDIR}/norcomm_clones.tsv

# if OUTPUTDIR does not exist, create it
if ( ! -d ${OUTPUTDIR} ) then
        mkdir -p ${OUTPUTDIR}
endif

#
# wget
# -S = print the headers sent by HTTP servers and responses sent by FTP servers.
# -O = full path to output file
# -t = number of retries
# sort
# -r = reverse
# -k 7 = sort by the 7th column
#

wget -S -O- -t 10 "${URL}" | sort -rk 7 > ${OUTPUTFILE}

