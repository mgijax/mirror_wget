#!/bin/csh -f

#
# Program: www.europhenome.org
#
# Original Author: lec
#
# Purpose:
#
#	Download the europhenome biomart mammalian phenotype data
#	TR10273
#
# easier to read:
#
# uniqueRows="1"
#
# p-value cutoff parameter
# <Filter name="significance" value="0.0001"/>
#
# <Attribute name="pipeline"/>
# <Attribute name="escell_clone"/>
# <Attribute name="mp_term"/>
# <Attribute name="allele_id"/>
# <Attribute name="zygosity"/>
# <Attribute name="allele_name"/>
# <Attribute name="mgi_accession_id"/>
# <Attribute name="international_strain_name"/>
# <Attribute name="stocklist_id"/>
# <Attribute name="sex"/>
# <Attribute name="significance"/>
#

cd `dirname $0` && source ./Configuration && cd ${DATADOWNLOADS}

# Full URL of the file
setenv URL	'http://www.europhenome.org/biomart/martservice?query=<?xml version="1.0" encoding="UTF-8"?><\!DOCTYPE Query><Query virtualSchemaName="default" formatter="TSV" header="0" uniqueRows="1" count="" datasetConfigVersion="0.6"><Dataset name= "europhenome" interface="default"><Filter name="significance" value="0.0001"/><Attribute name="pipeline"/><Attribute name="escell_clone"/><Attribute name="mp_term"/><Attribute name="allele_id"/><Attribute name="zygosity"/><Attribute name="allele_name"/><Attribute name="mgi_accession_id"/><Attribute name="international_strain_name"/><Attribute name="stocklist_id"/><Attribute name="sex"/><Attribute name="significance"/></Dataset></Query>'

# Base URL of the file
setenv BASEURL www.europhenome.org

# full path to log file
setenv LOGFILE	${MIRRORLOG}/${BASEURL}.log

# output directory
setenv OUTPUTDIR	${DATADOWNLOADS}/${BASEURL}

# output file
setenv OUTPUTFILE	${OUTPUTDIR}/mgi_europhenome_mp.tsv

# if OUTPUTDIR does not exist, create it
if ( ! -d ${OUTPUTDIR} ) then
        mkdir -p ${OUTPUTDIR}
endif

#
# -r = overwrite existing copy with new copy
# -x = force file to be saved in URL directory hierarchy
# -S = print the headers sent by HTTP servers and responses sent by FTP servers.
# -N = turn on time stamping (so file doesn't get downloaded if no changes)
# -t = number of retries
# -O = full path to output file

wget -S -O- -t 10 "${URL}" | sort -rk 7 > ${OUTPUTFILE}

